/**
 * Created by 贝贝 on 2016/12/29.
 */
//通知公告----组织架构树
define(function () {

    return function (data) {

        // data=[{"orgName":"星杰集团总部","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456492000,"orgCode":"001","uUserCode":"US000000001","operationType":"UPDATE","id":153,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"0","groupCode":null,"lastUpdateTime":1488457201000},{"orgName":"总裁办","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456562000,"orgCode":"001001","uUserCode":"US000000001","operationType":"INSERT","id":156,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001","groupCode":null,"lastUpdateTime":1488456562000},{"orgName":"上海大区","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456623000,"orgCode":"001002","uUserCode":"US000000001","operationType":"INSERT","id":157,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001","groupCode":null,"lastUpdateTime":1488456623000},{"orgName":"苏州分公司","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456634000,"orgCode":"001003","uUserCode":"US000000001","operationType":"INSERT","id":158,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001","groupCode":null,"lastUpdateTime":1488456634000},{"orgName":"杭州分公司","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456643000,"orgCode":"001004","uUserCode":"US000000001","operationType":"INSERT","id":159,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001","groupCode":null,"lastUpdateTime":1488456643000},{"orgName":"分公司一","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456877000,"orgCode":"001002001","uUserCode":"US000000001","operationType":"INSERT","id":160,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002","groupCode":null,"lastUpdateTime":1488456877000},{"orgName":"分公司二","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456885000,"orgCode":"001002002","uUserCode":"US000000001","operationType":"INSERT","id":161,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002","groupCode":null,"lastUpdateTime":1488456885000},{"orgName":"分公司三","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456899000,"orgCode":"001002003","uUserCode":"US000000001","operationType":"INSERT","id":162,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002","groupCode":null,"lastUpdateTime":1488456899000},{"orgName":"陆家嘴门店","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456918000,"orgCode":"001002001001","uUserCode":"US000000001","operationType":"INSERT","id":163,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002001","groupCode":null,"lastUpdateTime":1488456918000},{"orgName":"浦东门店","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456943000,"orgCode":"001002002001","uUserCode":"US000000001","operationType":"INSERT","id":164,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002002","groupCode":null,"lastUpdateTime":1488456943000},{"orgName":"徐家汇门店","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456955000,"orgCode":"001002003001","uUserCode":"US000000001","operationType":"INSERT","id":165,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002003","groupCode":null,"lastUpdateTime":1488456955000},{"orgName":"新江湾门店","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488456982000,"orgCode":"001002001002","uUserCode":"US000000001","operationType":"INSERT","id":166,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002001","groupCode":null,"lastUpdateTime":1488456982000},{"orgName":"虹桥门店","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457018000,"orgCode":"001002003002","uUserCode":"US000000001","operationType":"INSERT","id":167,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002003","groupCode":null,"lastUpdateTime":1488457018000},{"orgName":"普陀门店","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457214000,"orgCode":"001002002002","uUserCode":"US000000001","operationType":"INSERT","id":168,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002002","groupCode":null,"lastUpdateTime":1488457214000},{"orgName":"设计师团队","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457238000,"orgCode":"001002001001001","uUserCode":"US000000001","operationType":"INSERT","id":169,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002001001","groupCode":null,"lastUpdateTime":1488457238000},{"orgName":"客户经理","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457248000,"orgCode":"001002001001002","uUserCode":"US000000001","operationType":"INSERT","id":170,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002001001","groupCode":null,"lastUpdateTime":1488457248000},{"orgName":"混成旅(红醍半岛)","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457516000,"orgCode":"001002001001003","uUserCode":"US000000001","operationType":"INSERT","id":171,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002001001","groupCode":null,"lastUpdateTime":1488457516000},{"orgName":"设计服务团队","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457568000,"orgCode":"001002001001003001","uUserCode":"US000000001","operationType":"INSERT","id":172,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002001001003","groupCode":null,"lastUpdateTime":1488457568000},{"orgName":"混成旅(汤臣一品)","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457664000,"orgCode":"001002001003","uUserCode":"US000000001","operationType":"INSERT","id":173,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002001","groupCode":null,"lastUpdateTime":1488457664000},{"orgName":"设计服务团队","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457675000,"orgCode":"001002001003001","uUserCode":"US000000001","operationType":"INSERT","id":174,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002001003","groupCode":null,"lastUpdateTime":1488457675000},{"orgName":"混成旅(世贸佘山)","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457729000,"orgCode":"001002004","uUserCode":"US000000001","operationType":"INSERT","id":175,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002","groupCode":null,"lastUpdateTime":1488457729000},{"orgName":"设计服务团队","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457738000,"orgCode":"001002004001","uUserCode":"US000000001","operationType":"INSERT","id":176,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002004","groupCode":null,"lastUpdateTime":1488457738000},{"orgName":"设计师团队","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457801000,"orgCode":"001002002001001","uUserCode":"US000000001","operationType":"INSERT","id":177,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002002001","groupCode":null,"lastUpdateTime":1488457801000},{"orgName":"客户经理","isDelete":0,"groupId":null,"extCode":null,"extParentCode":null,"entCode":"SYSTEM","createTime":1488457810000,"orgCode":"001002002001002","uUserCode":"US000000001","operationType":"INSERT","id":178,"cUserCode":"US000000001","orgDesc":"","orgParentCode":"001002002001","groupCode":null,"lastUpdateTime":1488457810000}];

        //节点容器
        var treeStorage = {},
            //记录
            recordKeys = {},
            useKey = {};

        data.forEach(function (nodeInfo) {
            recordKeys[nodeInfo.orgCode] = false;
            delete useKey[nodeInfo.orgCode];
            recordKeys[nodeInfo.orgParentCode] = recordKeys[nodeInfo.orgParentCode] === false ? false : useKey[nodeInfo.orgParentCode] = treeStorage[nodeInfo.orgParentCode], true;
            ((treeStorage[nodeInfo.orgParentCode] = treeStorage[nodeInfo.orgParentCode] || {children: []}).children || (treeStorage[nodeInfo.orgParentCode].children = [])).push(treeStorage[nodeInfo.orgCode] = treeStorage[nodeInfo.orgCode] ? treeStorage[nodeInfo.orgCode].extend({name: nodeInfo.orgName,isOpen:true}, nodeInfo) : {}.extend(nodeInfo, {name: nodeInfo.orgName,isOpen:true}))
        });
        treeData = (treeStorage[0]||useKey[0]).children;
        useKey=treeStorage = recordKeys = null;
        return treeData;
    }
});